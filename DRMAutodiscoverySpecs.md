# The DRM XML namespace

This XML namespace is used to convey information about the DRM scheme used
to encrypt documents served through OPDS feeds, and to provide the
information necessary for a client to download and decrypt those
documents.

The URI for this namespace is
`http://librarysimplified.org/terms/drm`. It is sometimes prefixed as
`drm` in examples, e.g. `drm:clientToken`.

This namespace defines one tag (`drm`), and two attributes (`scheme`, `clientToken`, and `serverToken`).

## `drm:drm`

The `drm:drm` tag indicates that some special DRM-specific information
will help the client decode a representation. In some cases, it may
not be possible to even retrieve a representation without the
information kept in the `drm:drm` tag.

This document defines the semantics of the `drm:drm` tag when the value of
the `scheme` attribute is one defined in the DRM Scheme Registry. It
does not define the semantics of the `drm` tag when the value of the
`scheme` attribute is a URI not found in the DRM Scheme Registry.

The `drm:drm` tag MAY be the child of an `atom:link` tag. When it appears,
it is intended to shed light on the representation that will be
returned by following that link.

The `drm:drm` tag MUST provide a value for the `drm:scheme`
attribute. Its purpose is to help a client jump through DRM hoops, not to signal the mere presence of DRM (the `vnd.librarysimplified/obfuscated` media type can be used for that.) Depending on the DRM scheme in use, values for the `drm:clientToken` and `drm:serverToken` attributes might be required, optional, or forbidden.

## `drm:scheme`

The value of the `scheme` attribute identifies the DRM scheme in
use. This MUST either be a short string from the DRM Scheme Registry
(q.v.), or a URI.

When the `drm:drm` tag is used, it MUST provide a value for the
`drm:scheme` attribute.

## `drm:clientToken`

The `drm:clientToken` tag either contains or links to a piece of information that may be
necessary or useful in authenticating or authorizing the client with the DRM server. This information might be necessary to obtain the DRM-encrypted resource, or to decrypt it after obtaining it.

The `drm:clientToken` tag MAY contain a string leaf node. If present, the string value of the leaf node MUST be interpreted as a client token.

The `drm:clientToken` tag MAY contain a `drm:href` attribute. If present, sending an authenticated GET request to the value of the `drm:href` attribute MUST result in an response with the `Content-Type` server set to `vnd.librarysimplified/drm-client-registration-token`. The contents of the entity-body MUST be interpreted as a client token.

The meaning of the client token obtained from a `drm:clientToken` tag depends on the value of the `drm:type` attribute in the enclosing `drm:drm` tag.

### Client token under ACS

When the Adobe ACS DRM scheme is in use, the client token MUST be interpreted as base64-encoded `authData` that can be used to obtain an Adobe ID. If the client already has an Adobe ID, the client token MAY be ignored.

If no client token is provided, and the client has no Adobe ID, the client MAY proceed with fulfilling a book as usual, but will most likely be unable to download or decrypt the ACS-encrypted resource.

### Client token under URMS

When the URMS DRM scheme is in use, the client token MUST be interpreted as an AuthToken like the one generated by the URMS "Generate Authtoken" endpoint. For example, if the entity-body of the
response to the "Generate Authtoken" endpoint looks like this:

```
{
       "statusCode": 0,
       "message": "Success.",
       "authToken": "3375:z4nk82tdj32hf4ad"
}
```

Then the client token would look like `3375:z4nk82tdj32hf4ad`.

Since generating a URMS Authtoken is an expensive operation, it is recommended that URMS client tokens be retrieved on demand (through the URL in the `drm:href` attribute) rather than provided in advance (through the `drm:token` attribute).

### Client token under LCP

When the Readium LCP DRM scheme is in use, the client token MUST be interpreted as the LCP user key that guards
the resource. If the client knows the User Passphrase, the client token MAY be ignored -- the client can hash the User Passphrase and get the same result. If no client token is provided, the client MUST prompt for the User Passphrase as per the LCP spec.

## `drm:serverToken`

The `drm:serverToken` tag contains information that may be useful in distinguishing between multiple DRM servers of the same type.

This tag supports two optional attributes, `drm:href` and `drm:serverID`. The meaning of these attributes differ depending on the DRM scheme in use.

When the URMS DRM scheme is in use, the value of `drm:href` is the URL of the URMS Store that provides the resource. The value of `drm:serverID` is the ID of the URMS Store that provides the resource.

When the LCP or Adobe DRM schemes are in use, the value of `drm:href` and `drm:serverID` within a `drm:serverToken` tag are undefined.

# The DRM Scheme Registry

This specification serves as a registry for reserved strings
corresponding to popular DRM schemes. The following schemes are
defined:

| Short string | URI | Description |
| ------------ | --- | ----------- |
| ACS | http://librarysimplified.org/terms/drm/scheme/ACS | Adobe ACS |
| URMS | http://librarysimplified.org/terms/drm/scheme/URMS | Sony URMS |
| LCP | http://librarysimplified.org/terms/drm/scheme/LCP | Readium LCP |

# The `vnd.librarysimplified/obfuscated` media type

This media type is used to describe a document that has been
obfuscated or encrypted according to a DRM scheme or some other
algorithm. The document may be served as some other media type, such
as `application/epub+zip`, and may even be recognizable as a file of that
type, but cannot be properly processed or understood until it is decrypted or
deobfuscated.

This media type defines two optional parameters:

*scheme*: A non-empty list of space-separated URIs identifying the
algorithm(s) used to encrypt or obfuscate the representation. URIs
found in the DRM Scheme Registry are especially appropriate values for
*scheme*. If multiple URIs are present, they should be listed in the
order they were applied to the original representation.

*original-type*: The name of a media type, representing the
representation's original media type before encryption and obfuscation
were applied. To avoid ambiguity, this media type may not have parameters applied to it. (TODO: URL-escaping the parameter value would allow parameters to be applied to it.)

# The `vnd.librarysimplified/drm-client-registration-token` media type

A document of this media type represents a currently active client token (see "`drm:clientToken"). Apart from this fact, its semantics are identical to the semantics of `application/octet-stream`.

# The `ccid-urms` URL scheme

The `ccid-urms` URL scheme is a way of linking to a URMS-encrypted resource by its CCID. The format is `ccid-urms:{ccid}`, where `{ccid}` is the CCID.

Example: `ccid-urms:000000000000000000000000000001` refers to the URMS resource with CCID "000000000000000000000000000001".

A `ccid-urms` URL is dereferenced by downloading (if necessary) and decrypting the URMS resource identified by the CCID. Generally this means extracting the CCID and passing it into the `RegisterBookTask` method of the URMS SDK, or the equivalent method of a compatible SDK.

If the resource is cached locally, a `ccid-urms` URL may be dereferenced by decrypting the cached resource, without downloading it again.

The `ccid-urms` scheme introduces no special security considerations beyond those introduced by the URMS system itself.

The `ccid-urms` scheme does not define semantics for the fragment identifier.

The name of the scheme was chosen to be `ccid-urms`, rather than `urms-ccid`, because of Section 2.5 of [RFC 2718](https://tools.ietf.org/html/rfc2718).

# atom:link inside atom:link